---
title: "01_creating-your-own-theme"
author: "Jeremy Mikecz"
editor: visual
format: html
---

# Applying your own style guide to your visualizations

## Part 1: Reloading Gapminder data

Before beginning with customization, let's first reload our gapminder visualization.

```{r}

library(tidyverse)
library(viridis)
library(systemfonts)
library(showtext)
```

```{r}
# note: to open the gapminder dataset, we have to use a different relative path
# than last week since this notebook is in a different location

df <- read.csv("../../week3/data/gapminder.csv")
head(df)
```

```{r}
yr = 1997
tempdf <- df |>
    filter(year == yr)

p <- ggplot(tempdf, aes(x= gdpPercap, y=lifeExp, color=continent, size=pop)) +
    geom_point(alpha=0.6) +
    scale_x_continuous(trans="log10") +
    scale_size_continuous(range = c(1, 15)) +
    labs(x="GDP per capita", y = "Life expectancy at birth (years)", 
         title = sprintf("Scatterplot: per capita GDP vs. life expectancy, %s", yr),
       caption = "(Based on data from Hans Rosling - gapminder.com)", 
       color = 'Continent',
       size = "Population")
    #scale_color_viridis(discrete=TRUE, option="turbo")

p

```

[list of ggplot themes](https://ggplot2.tidyverse.org/reference/ggtheme.html)

```{r}
p + 
 theme_bw()
```

```{r}
windowsFonts()
```

```{r}
#install.packages("showtext")
library(showtext)
```

```{r}
font_add_google(name = "pacifico", #fonts on the Google Fonts site 
                family = "pacifico") # Load the fonts for all graphic devices
showtext_auto()
```

```{r}
p
```

Add title, labels with custom font

```{r}
boxplot(trees$Volume, main = "", xlab = "", ylab = "", ylim = c(0, 90), col = 3)
title("Volume of Trees", family = "pacifico", cex.main = 2, col.main = "blue")
title(ylab = "Volume (cu.ft)", family = "pacifico", cex.lab = 1.2, col.lab = "pink")
text(x = 3, y = 85, "Outlier", family = "pacifico", cex = 1.2, col = "red")
```

Go to Google Fonts and find one font family you like.

Copy and paste the code from the above two code cells below, this time replacing it with the name of the font of your choice.

```{r}
fontname = "Montserrat"
fontfamily = "montserrat"

font_add_google(name = fontname,   #fonts on the Google Fonts site
                family = fontfamily)
# Load the fonts for all graphic devices
showtext_auto()

boxplot(trees$Volume,
        main = "", xlab = "", ylab = "",
        ylim = c(0, 90),
        col = 3)

# Add the title, Y-axis label, and text with the custom font
title("Volume of Trees", family = fontfamily, cex.main = 2, col.main = "blue") 
title(ylab = "Volume (cu.ft)", family = fontfamily, cex.lab = 1.2, col.lab = "pink") 
text(x = 3, y = 85, "Outlier", family = fontfamily, cex = 1.2, col = "red")
```

## 2. Import additional themes with ggthemes

Besides the default ggplot themes, you can supplement with additional themes using the [ggthemes](https://r-graph-gallery.com/package/ggthemes.html) package.

For more information see the ggthemes [github page](https://jrnold.github.io/ggthemes/), the R Graph Gallery [tutorial](https://r-graph-gallery.com/package/ggthemes.html), and

```{r}
# install.packages("ggthemes")
```

```{r}
library(ggthemes)
```

To get a list of available themes from ggthemes, run this:

```{r}
themes <- lsf.str("package:ggthemes", pattern = "theme_")
themes
```

```{r}
p + theme_economist()
```

```{r}
p + theme_economist() +
    scale_color_economist()
```

```{r}
p + theme_economist_white()+
    scale_color_economist()
```

```{r}
p + theme_fivethirtyeight()
```

```{r}
p + theme_fivethirtyeight() +
    scale_color_fivethirtyeight()
```

```{r}
p + theme_wsj()
```

## Reconstruct theme from *The Urban Institute*

As you have seen, there are a few different preloaded themes available for use with ggplot, but they are rather limited and not very interesting.

**ggthemes** provides additional options.

Often, however, we may prefer to create our own theme based on our own style guide.

Before trying to create our own personalized theme, however, let's try to create a theme using an existing style guide, that of the *Urban Institute*.

-   this is a useful theme to start with as The Urban Institute has carefully outlined their design choices in their [style guide](https://urbaninstitute.github.io/graphics-styleguide/).

-   Note: the Urban Institute has already done this using [urbnthemes](https://urbaninstitute.github.io/urbnthemes/) package, but we will recreate this theme from scratch.

-   [List](https://docs.google.com/spreadsheets/d/1F1gm5QLXh3USC8ZFx_M9TXYxmD-X5JLDD0oJATRTuIE/edit?usp=sharing) of other style guides available online

First, the Urban Institute uses Google's [Lato](https://fonts.google.com/specimen/Lato) font. Let's import it:

```{r}
font_add_google("Lato", "Lato")
font_add_google("Lato", "Lato Light", regular.wt = 300)
font_add_google("Lato", "Lato Bold", regular.wt = 700)

# Automatically use showtext for graphics
showtext_auto()
```

Next, we should set the Urban Institute color palette:

```{r}
# Urban Institute Color Palette
urban_colors <- list(
  # Primary colors
  cyan = "#1696d2",
  gray = "#d2d2d2",
  black = "#000000",
  
  # Secondary colors
  yellow = "#fdbf11",
  magenta = "#ec008b",
  green = "#55b748",
  space_gray = "#5c5859",
  red = "#db2b27",
  
  # Shades of cyan
  cyan_shade = c("#CFE8F3", "#A2D4EC", "#73BFE2", "#46ABDB", "#1696D2", "#12719E"),
  
  # Shades of gray
  gray_shade = c("#F5F5F5", "#ECECEC", "#E3E3E3", "#DCDBDB", "#D2D2D2", "#9D9D9D"),
  
  # Categorical palette
  categorical = c("#1696d2", "#ec008b", "#fdbf11", "#55b748", "#5c5859", "#db2b27")
)
```

```{r}

# Function to access Urban Institute colors
urban_palette <- function(palette = "categorical", n = NULL, reverse = FALSE) {
  pal <- urban_colors[[palette]]
  
  if (reverse) pal <- rev(pal)
  
  if (!is.null(n)) {
    if (n <= length(pal)) {
      pal <- pal[1:n]
    } else {
      pal <- colorRampPalette(pal)(n)
    }
  }
  
  return(pal)
}
```

Create custom "theme_urban".

```{r}
# Main Urban Institute theme function
theme_urban <- function(base_size = 12,
                        base_family = "Lato",
                        base_line_size = 0.5,
                        base_rect_size = 0.5) {
  
  theme_minimal(base_size = base_size,
                base_family = base_family,
                base_line_size = base_line_size,
                base_rect_size = base_rect_size) +
    theme(
      # Plot elements
      plot.title = element_text(
        family = "Lato Bold",
        size = rel(2),
        face = "bold",
        hjust = 0,
        margin = margin(b = 10),
        color = urban_colors$black
      ),
      plot.subtitle = element_text(
        size = rel(1.5),
        hjust = 0,
        margin = margin(b = 15),
        color = urban_colors$space_gray
      ),
      plot.caption = element_text(
        size = rel(1),
        hjust = 0,
        margin = margin(t = 15),
        color = urban_colors$space_gray
      ),
      plot.title.position = "plot",
      plot.caption.position = "plot",
      plot.background = element_rect(fill = "white", color = NA),
      
      # Panel elements
      panel.grid.major = element_line(color = urban_colors$gray, size = 0.3),
      panel.grid.minor = element_blank(),
      panel.grid.major.x = element_blank(),
      panel.background = element_rect(fill = "white", color = NA),
      
      # Axis elements
      axis.title = element_text(
        family = "Lato Bold",
        size = rel(1.2),
        color = urban_colors$black,
        face = "bold"
      ),
      axis.title.x = element_text(margin = margin(t = 10)),
      axis.title.y = element_text(margin = margin(r = 10)),
      axis.text = element_text(
        size = rel(1),
        color = urban_colors$space_gray
      ),
      axis.ticks = element_blank(),
      axis.line = element_blank(),
      
      # Legend elements
      legend.position = "right",
      legend.justification = "left",
      legend.title = element_text(
        size = rel(1.1),
        face = "bold",
        color = urban_colors$black
      ),
      legend.text = element_text(
        size = rel(0.8),
        color = urban_colors$space_gray
      ),
      legend.key = element_blank(),
      legend.background = element_blank(),
      
      # Strip (facet) elements
      strip.text = element_text(
        family = "Lato Bold",
        size = rel(1),
        face = "bold",
        hjust = 0,
        color = urban_colors$black
      ),
      strip.background = element_blank(),
      
      # Margins
      plot.margin = margin(15, 15, 15, 15)
    )
}
```

Create color scales for discrete data.

```{r}
# Color scale functions
scale_color_urban <- function(palette = "categorical", reverse = FALSE, ...) {
  pal <- urban_palette(palette = palette, reverse = reverse)
  
  ggplot2::discrete_scale(
    "colour", 
    paste0("urban_", palette),
    palette = function(n) pal[1:n],
    ...
  )
}

scale_fill_urban <- function(palette = "categorical", reverse = FALSE, ...) {
  pal <- urban_palette(palette = palette, reverse = reverse)
  
  ggplot2::discrete_scale(
    "fill", 
    paste0("urban_", palette),
    palette = function(n) pal[1:n],
    ...
  )
}
```

Create color scales for continuous data.

```{r}
# Continuous color scales
scale_color_urban_c <- function(palette = "cyan_shade", reverse = FALSE, ...) {
  pal <- urban_palette(palette = palette, reverse = reverse)
  
  ggplot2::scale_color_gradientn(colors = pal, ...)
}

scale_fill_urban_c <- function(palette = "cyan_shade", reverse = FALSE, ...) {
  pal <- urban_palette(palette = palette, reverse = reverse)
  
  ggplot2::scale_fill_gradientn(colors = pal, ...)
}
```

Create a sample bar graph.

```{r}
# Example usage
df <- data.frame(
  category = c("Category A", "Category B", "Category C", "Category D"),
  value = c(23, 45, 12, 34)
)

sample_p <- ggplot(df, aes(x = reorder(category, value), y = value)) +
  geom_col(fill = urban_colors$cyan, width = 0.7) +
  coord_flip() +
  labs(
    title = "Example with Lato Font",
    subtitle = "Urban Institute styling with proper typography",
    caption = "Source: Example data",
    x = NULL,
    y = "Values"
  ) +
  theme_urban()

print(sample_p)

# Save with proper font rendering
ggsave("urban_plot.png", sample_p, width = 8, height = 6, dpi = 150)
```

```{r}
# Example plot
p_urban <- p +
  theme_urban()

print(p_urban)


# For saving plots with showtext
ggsave("gapminder_UrbanInst-theme.png", p_urban, width = 5, height = 4, dpi = 150)
```

```{r}
```

```{r}

```

```{r}

```

For further instructions how to create custom themes visit Maddie Pickens, "Learning to create custom themes in ggplot."

# 

# 
