---
title: "01_creating-your-own-theme"
author: "Jeremy Mikecz"
editor: visual
format: html
---

# Applying your own style guide to your visualizations

## 1. Setup + Reload Gapminder data

Before beginning with customization, let's first reload our gapminder visualization.

```{r}

library(tidyverse)
library(viridis)
library(systemfonts)
library(showtext)
```

```{r}
# note: to open the gapminder dataset, we have to use a different relative path
# than last week since this notebook is in a different location

df <- read.csv("../../week3/data/gapminder.csv")
head(df)
```

## 2. Create static scatterplot of Gapminder data

This is the same code we developed in the previous notebook.

```{r}
yr = 1997
tempdf <- df |>
    filter(year == yr)

p <- ggplot(tempdf, aes(x= gdpPercap, y=lifeExp, color=continent, size=pop)) +
    geom_point(alpha=0.6) +
    scale_x_continuous(trans="log10") +
    scale_size_continuous(range = c(1, 15)) +
    labs(x="GDP per capita", y = "Life expectancy at birth (years)", 
         title = sprintf("Scatterplot: per capita GDP vs. life expectancy, %s", yr),
       caption = "(Based on data from Hans Rosling - gapminder.com)", 
       color = 'Continent',
       size = "Population")
    #scale_color_viridis(discrete=TRUE, option="turbo")

p

```

## 3. Using Themes

For each plot you make, you can customize in a variety of ways. You can customize the text (justification, font family, style, size, color), the plot itself (background color, axes, axes labels, tick labels), the legend, and more.

However, if you regularly create visualizations this can be tedious to modify every time. This is especially the case if you are preparing plots for publication: you'll want to create and apply a consistent style. We can do that in R in several ways (in order of complexity):

1.  use a preset ggplot theme (Step 4 below)
2.  import and use a preset theme from another R library (Step 5)
3.  create your own theme from scratch (Step 6).

## 4. GGplot Themes

GGplot provides a [list of ggplot themes](https://ggplot2.tidyverse.org/reference/ggtheme.html):\

```         
theme_grey() / theme_gray()
theme_bw()
theme_linedraw()
theme_light()
theme_dark()
theme_minimal()
theme_classic()
theme_void()
theme_test()
```

We can apply these themes to an existing plot quite simply:

```{r}
p +
    theme_minimal()
```

```{r}
p + 
 theme_bw()
```

Unfortunately, the these preset themes are limited and not very creative.

## 5. Import additional themes with ggthemes

Besides the default ggplot themes, you can supplement with additional themes using the [ggthemes](https://r-graph-gallery.com/package/ggthemes.html) package.

For more information see the **ggthemes** [github page](https://jrnold.github.io/ggthemes/) and this R Graph Gallery [tutorial](https://r-graph-gallery.com/package/ggthemes.html).

1.  To use **ggthemes** first install it.

```{r}
# install.packages("ggthemes")  #comment out after installed
```

2.  Import it.

```{r}
library(ggthemes)
```

3.  To get a list of available themes from ggthemes, review the links above or run this:

```{r}
themes <- lsf.str("package:ggthemes", pattern = "theme_")
themes
```

4.  Let's examine what these themes look like.

```{r}
p + 
    theme_foundation()
```

```{r}
p + 
    theme_economist()
```

```{r}
p + 
    theme_economist() +     
    scale_color_economist()
```

```{r}
p + 
    theme_economist_white()+
    scale_color_economist()
```

```{r}
p + 
    theme_fivethirtyeight()
```

```{r}
p + 
    theme_fivethirtyeight() +
    scale_color_fivethirtyeight()
```

### EXERCISE - ggthemes:

Experiment modifying our plot with another ggtheme. Find your favorite.

```{r}

```

## 6. Modifying an existing theme (font size & placement, etc.)

```{r}
windowsFonts()
```

```{r}
#install.packages("showtext")
library(showtext)
```

```{r}
google_font_list <- sysfonts::font_families_google()
writeLines(google_font_list, "google_fonts_list.txt")
```

```{r}
font_add_google(name = "Playfair Display SC", #fonts on the Google Fonts site 
                family = "Playfair Display SC" # Load the fonts for all graphic devices
)
font_add_google(name = "Montserrat",
                family = "Montserrat"
)
showtext_auto()
```

We can modify these existing themes using the **themes()** function. Below we apply custom font and font sizes to `theme_fivethirtyeight()` from **ggthemes**.

```{r}
yr = 1997
tempdf <- df |>
    filter(year == yr)

p <- ggplot(tempdf, aes(x= gdpPercap, y=lifeExp, color=continent, size=pop)) +
    geom_point(alpha=0.6) +
    scale_x_continuous(trans="log10") +
    scale_size_continuous(range = c(1, 15)) +
    labs(x="GDP per capita", y = "Life expectancy at birth (years)", 
         title = sprintf("Scatterplot: per capita GDP vs. life expectancy, %s", yr),
       caption = "(Based on data from Hans Rosling - gapminder.com)", 
       color = 'Continent',
       size = "Population") +
    #scale_color_viridis(discrete=TRUE, option="turbo")
    theme_fivethirtyeight() +
    theme(
        plot.title = element_text(family = "Playfair Display SC", size = 20),
        text = element_text(family = "Montserrat")
    )
p
```

**NOTE**: Within this notebook, some of these plots may not be scaled correctly. The goal of these in-notebook plots is just to get a quick preview. However, it is when we output these plots that we want to make sure they are exported in a way that works visually.

Save plot.

```{r}
ggsave(
    "../images/gapminder-scatter_custom.png",
)
```

You'll probably notice in this outputed png (in the `week4/images` folder that the text appears too small. We can fix this in two ways. One is to reduce the resolution of the plot:

```{r}
ggsave(
    "../images/gapminder-scatter_custom-small.png",
    width = 6,
    height = 4.5
)
```

Or we can increase the base size of our chosen theme's fonts (so we don't have to re-size all text elements individually).

```{r}
p <- p +
    theme_fivethirtyeight(base_size = 36) +
    theme(
        plot.title = element_text(family = "Playfair Display SC"),
        text = element_text(family = "Montserrat")
    )

ggsave(
    "../images/gapminder-scatter_custom-largerfont.png",
    width = 10,
    height = 7
)
```

I still don't like the scaling of this image's legend (open "gapminder-scatter_custom-largerfont.png" which is saved in the `week4/images` folder). Before trying to further customize the `fivethirtyeight()` theme we used above, let's view the underlying code:

```{r}
theme_fivethirtyeight
```

Note: this custom theme was built on

```{r}
p +
  theme(
    legend.box.spacing = unit(0.2, "cm"),  # Reduce space between plot and legend
    legend.margin = margin(t = 0, r = 0, b = 0, l = 0)  # Remove legend margins
  )

ggsave(
    "../images/gapminder-scatter_custom-largerfont2.png",
    width = 10,
    height = 7
)
```

Not perfect, but looking much better.

### Exercise: Export your own version of the Gapminder scatterplot using a theme from ggplot or ggtheme and then modifying it for both clarity and aesthetic style.

```{r}

```

## 
